<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassPass - Home</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Google Fonts - TT Norms Alternative (Using Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50" style="margin: 0; padding: 0; overflow: hidden;">
    
    <!-- Mobile Container -->
    <div class="home-container">
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="current-time">9:41</div>
            <div class="status-icons">
                <!-- Signal Icon -->
                <svg width="18" height="11" viewBox="0 0 18 11" fill="none">
                    <path d="M1.5 6.7002C1.77879 6.7002 1.91826 6.6996 2.03418 6.72266C2.51021 6.81734 2.88187 7.18999 2.97656 7.66602C2.99961 7.78193 3 7.92144 3 8.2002V9.2002C3 9.47886 2.99961 9.61848 2.97656 9.73438C2.88178 10.2102 2.51005 10.5821 2.03418 10.6768C1.91826 10.6998 1.77879 10.7002 1.5 10.7002C1.22121 10.7002 1.08174 10.6998 0.96582 10.6768C0.48995 10.5821 0.118223 10.2102 0.0234375 9.73438C0.000385105 9.61848 1.19764e-09 9.47886 0 9.2002V8.2002C0 7.92144 0.000388227 7.78193 0.0234375 7.66602C0.118125 7.18999 0.489792 6.81734 0.96582 6.72266C1.08174 6.6996 1.22121 6.7002 1.5 6.7002ZM6.2998 4.7002C6.57859 4.7002 6.71807 4.6996 6.83398 4.72266C7.31001 4.81734 7.68168 5.18999 7.77637 5.66602C7.79942 5.78193 7.7998 5.92143 7.7998 6.2002V9.2002C7.7998 9.47887 7.79942 9.61848 7.77637 9.73438C7.68158 10.2102 7.30986 10.5821 6.83398 10.6768C6.71807 10.6998 6.5786 10.7002 6.2998 10.7002C6.02101 10.7002 5.88154 10.6998 5.76562 10.6768C5.28975 10.5821 4.91803 10.2102 4.82324 9.73438C4.80019 9.61848 4.7998 9.47887 4.7998 9.2002V6.2002C4.7998 5.92143 4.80019 5.78193 4.82324 5.66602C4.91793 5.18999 5.2896 4.81734 5.76562 4.72266C5.88154 4.6996 6.02102 4.7002 6.2998 4.7002ZM10.9004 2.40039C11.1789 2.40039 11.3187 2.3998 11.4346 2.42285C11.9104 2.51767 12.2823 2.89032 12.377 3.36621C12.3999 3.48207 12.4004 3.62185 12.4004 3.90039V9.2002C12.4004 9.47886 12.4 9.61848 12.377 9.73438C12.2822 10.2101 11.9103 10.5819 11.4346 10.6768C11.3187 10.6998 11.1789 10.7002 10.9004 10.7002C10.6218 10.7002 10.4821 10.6998 10.3662 10.6768C9.89025 10.5821 9.51761 10.2103 9.42285 9.73438C9.3998 9.61848 9.40039 9.47886 9.40039 9.2002V3.90039C9.40039 3.62187 9.39986 3.48206 9.42285 3.36621C9.51754 2.89018 9.89018 2.51754 10.3662 2.42285C10.4821 2.39986 10.6219 2.40039 10.9004 2.40039ZM15.6006 0C15.8788 7.85124e-09 16.018 0.000458564 16.1338 0.0234375C16.6098 0.118122 16.9824 0.489814 17.0771 0.96582C17.1002 1.08174 17.1006 1.22121 17.1006 1.5V9.2002C17.1006 9.47886 17.1002 9.61848 17.0771 9.73438C16.9824 10.2103 16.6097 10.5821 16.1338 10.6768C16.018 10.6997 15.8788 10.7002 15.6006 10.7002C15.3221 10.7002 15.1823 10.6997 15.0664 10.6768C14.5905 10.5821 14.2178 10.2103 14.123 9.73438C14.1 9.61848 14.1006 9.47886 14.1006 9.2002V1.5C14.1006 1.22121 14.1 1.08174 14.123 0.96582C14.2178 0.489814 14.5904 0.118122 15.0664 0.0234375C15.1823 0.000445124 15.3221 0 15.6006 0Z" fill="black"/>
                </svg>
                <!-- WiFi Icon -->
                <svg width="16" height="12" viewBox="0 0 16 12" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.70042 2.29636C9.93483 2.29646 12.0838 3.15501 13.7032 4.69457C13.8251 4.81343 14.02 4.81193 14.1401 4.69121L15.3058 3.51479C15.3666 3.45356 15.4005 3.37062 15.4 3.28433C15.3995 3.19803 15.3646 3.11549 15.3031 3.05498C11.0528 -1.01833 4.3474 -1.01833 0.0970716 3.05498C0.0355014 3.11545 0.000571881 3.19796 7.20154e-06 3.28426C-0.000567562 3.37055 0.033283 3.45352 0.0940465 3.51479L1.26005 4.69121C1.38006 4.81211 1.57513 4.81361 1.697 4.69457C3.31657 3.15491 5.46579 2.29636 7.70042 2.29636ZM7.70042 6.12375C8.92809 6.12367 10.1119 6.57999 11.022 7.40402C11.145 7.52097 11.3389 7.51844 11.4589 7.39831L12.6232 6.22189C12.6845 6.16019 12.7186 6.07648 12.7177 5.98949C12.7168 5.9025 12.6811 5.8195 12.6185 5.75906C9.84735 3.18131 5.55584 3.18131 2.78469 5.75906C2.72209 5.8195 2.68637 5.90255 2.68555 5.98956C2.68473 6.07657 2.71887 6.16028 2.78031 6.22189L3.9443 7.39831C4.06427 7.51844 4.25817 7.52097 4.38125 7.40402C5.29065 6.58053 6.47357 6.12425 7.70042 6.12375ZM9.93779 8.93135C10.0001 8.87023 10.0344 8.78613 10.0326 8.6989C10.0308 8.61167 9.99309 8.52905 9.92837 8.47053C8.64214 7.38263 6.75834 7.38263 5.47211 8.47053C5.40735 8.529 5.36959 8.6116 5.36775 8.69883C5.3659 8.78606 5.40014 8.87019 5.46236 8.93135L7.47672 10.9639C7.53576 11.0236 7.61625 11.0572 7.70025 11.0572C7.78423 11.0572 7.86472 11.0236 7.92376 10.9639L9.93779 8.93135Z" fill="black"/>
                </svg>
                <!-- Battery Icon -->
                <svg width="25" height="12" viewBox="0 0 25 12" fill="none">
                    <path d="M18.4102 0C19.6582 0 20.1111 0.130042 20.5674 0.374023C21.0237 0.618053 21.3819 0.976321 21.626 1.43262C21.87 1.88887 22 2.34185 22 3.58984V7.91016C22 9.15815 21.87 9.61113 21.626 10.0674C21.3819 10.5237 21.0237 10.8819 20.5674 11.126C20.1111 11.37 19.6582 11.5 18.4102 11.5H3.58984C2.34185 11.5 1.88887 11.37 1.43262 11.126C0.976321 10.8819 0.618053 10.5237 0.374023 10.0674C0.130042 9.61113 0 9.15815 0 7.91016V3.58984C0 2.34185 0.130042 1.88887 0.374023 1.43262C0.618053 0.976321 0.976321 0.618053 1.43262 0.374023C1.88887 0.130042 2.34185 0 3.58984 0H18.4102ZM23 3.69043C23.0184 3.69985 24.5 4.46155 24.5 5.69043C24.4997 6.92675 23 7.69043 23 7.69043V3.69043Z" fill="black" fill-opacity="0.36"/>
                    <rect x="0.5" y="0.5" width="18" height="7.66667" rx="1.6" fill="black"/>
                </svg>
            </div>
        </div>

        <!-- Page Content -->
        <div class="page-content">
            
            <!-- Header -->
            <div class="page-header">
                <div class="header-title">
                    <h1>Hi Leo</h1>
                    <button class="search-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M10.7209 3.22998C14.8189 3.23022 18.1408 6.55282 18.1408 10.6509C18.1407 12.4596 17.4926 14.1164 16.4172 15.4038C16.4944 15.444 16.5672 15.4972 16.632 15.562L19.3947 18.3247C19.7361 18.6664 19.7363 19.2204 19.3947 19.562C19.0531 19.9036 18.4991 19.9034 18.1574 19.562L15.3937 16.7993C15.3191 16.7246 15.2619 16.6389 15.2199 16.5483C13.9716 17.5021 12.4132 18.0707 10.7209 18.0708C6.62282 18.0708 3.30022 14.7489 3.29999 10.6509C3.29999 6.55267 6.62268 3.22998 10.7209 3.22998ZM10.7209 4.97998C7.58918 4.97998 5.04999 7.51917 5.04999 10.6509C5.05022 13.7824 7.58932 16.3208 10.7209 16.3208C13.8522 16.3206 16.3906 13.7822 16.3908 10.6509C16.3908 7.51932 13.8524 4.98022 10.7209 4.97998Z" fill="black"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                
                <!-- Recommended for you Section -->
                <section class="section" id="recommended-section">
                    <div class="section-header">
                        <h2 id="section-title">Recommended for you</h2>
                        <div class="section-actions">
                            <!-- Book All Button (Hidden by default) -->
                            <button id="book-all-btn" class="book-all-btn hidden">Book all</button>
                            
                            <!-- AI Icon -->
                            <svg id="ai-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" style="cursor: pointer;">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.58631 4.00045L6.90089 5.93966C6.8226 6.1611 6.69577 6.36224 6.52968 6.52832C6.36359 6.6944 6.16245 6.82123 5.94099 6.89952L3.99945 7.58566C2.66685 8.05809 2.66685 9.94256 3.99945 10.4142L5.94099 11.1004C6.16245 11.1787 6.36359 11.3055 6.52968 11.4716C6.69577 11.6377 6.8226 11.8388 6.90089 12.0602L7.58631 14.0002C8.05726 15.3328 9.94255 15.3335 10.4143 14.001L11.1019 12.0587C11.1803 11.8377 11.3071 11.6369 11.4731 11.4711C11.639 11.3053 11.8399 11.1786 12.0611 11.1004L14.0011 10.4135C15.333 9.94256 15.333 8.05809 14.0011 7.58641L12.0611 6.89952C11.8398 6.82121 11.6389 6.69446 11.4729 6.52851C11.307 6.36257 11.1802 6.16164 11.1019 5.94041L10.4143 3.99895C9.9418 2.66639 8.05651 2.66714 7.58631 4.00045ZM16.0575 13.667L15.6006 14.9598C15.5484 15.1074 15.4638 15.2415 15.3531 15.3522C15.2424 15.4629 15.1083 15.5475 14.9607 15.5997L13.6663 16.0571C12.7779 16.3721 12.7779 17.6284 13.6663 17.9428L14.9607 18.4003C15.1083 18.4524 15.2424 18.537 15.3531 18.6477C15.4638 18.7584 15.5484 18.8925 15.6006 19.0402L16.0575 20.3335C16.3715 21.2218 17.6284 21.2223 17.9428 20.334L18.4013 19.0392C18.4536 18.8918 18.5381 18.7579 18.6487 18.6474C18.7593 18.5368 18.8933 18.4524 19.0407 18.4003L20.3341 17.9423C21.222 17.6284 21.222 16.3721 20.3341 16.0576L19.0407 15.5997C18.8932 15.5475 18.7593 15.463 18.6486 15.3523C18.538 15.2417 18.4535 15.1078 18.4013 14.9603L17.9428 13.666C17.6279 12.7776 16.371 12.7781 16.0575 13.667Z" fill="url(#paint0_linear)"/>
                                <defs>
                                    <linearGradient id="paint0_linear" x1="12" y1="3" x2="12" y2="21" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#22A1E9" stop-opacity="0.67"/>
                                        <stop offset="0.5" stop-color="#9F70E7" stop-opacity="0.79"/>
                                        <stop offset="1" stop-color="#8362E4"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                            <!-- More Icon -->
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <circle cx="7" cy="12" r="1.5" fill="#676767"/>
                                <circle cx="12" cy="12" r="1.5" fill="#676767"/>
                                <circle cx="17" cy="12" r="1.5" fill="#676767"/>
                            </svg>
                        </div>
                    </div>

                    <!-- AI Input Box (Hidden by default) -->
                    <div id="ai-input-box" class="ai-input-wrapper hidden">
                        <div class="ai-textarea-container" id="chat-container">
                            <!-- Chat messages scroll independently -->
                            <div id="chat-messages"></div>
                            <!-- Textarea stays at bottom -->
                            <div class="ai-textarea-wrapper-inner">
                                <textarea id="ai-textarea" class="ai-textarea" rows="1" placeholder="Plan your week with AI"></textarea>
                                <!-- Feedback buttons (hidden by default) -->
                                <div id="feedback-buttons" class="feedback-buttons hidden">
                                    <button id="thumbs-up-btn" class="feedback-btn" title="Helpful">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20.6923 8.49999C21.1679 8.49999 21.5881 8.6824 21.9527 9.04724C22.3176 9.4119 22.5 9.83207 22.5 10.3077V11.923C22.5 12.028 22.4865 12.1405 22.4595 12.2605C22.4327 12.3803 22.4026 12.4922 22.3693 12.5962L19.5033 19.3587C19.3601 19.6786 19.1199 19.9487 18.7828 20.1692C18.4456 20.3897 18.0938 20.5 17.7273 20.5H7.2115V8.49999L13.0288 2.73274C13.2276 2.53407 13.4578 2.41549 13.7193 2.37699C13.9808 2.33849 14.2313 2.38332 14.471 2.51149C14.7108 2.63982 14.8865 2.8219 14.998 3.05774C15.1095 3.29357 15.1333 3.53782 15.0693 3.79049L13.9923 8.49999H20.6923ZM8.7115 9.13849V19H17.7308C17.8013 19 17.8733 18.9807 17.947 18.9422C18.0208 18.9037 18.077 18.8397 18.1155 18.75L21 12V10.3077C21 10.2179 20.9712 10.1442 20.9135 10.0865C20.8558 10.0288 20.7821 9.99999 20.6923 9.99999H12.0963L13.35 4.51924L8.7115 9.13849ZM4.30775 20.5C3.81058 20.5 3.385 20.323 3.031 19.969C2.677 19.615 2.5 19.1894 2.5 18.6922V10.3077C2.5 9.81057 2.677 9.38499 3.031 9.03099C3.385 8.67699 3.81058 8.49999 4.30775 8.49999H7.2115V9.99999H4.30775C4.21792 9.99999 4.14417 10.0288 4.0865 10.0865C4.02883 10.1442 4 10.2179 4 10.3077V18.6922C4 18.7821 4.02883 18.8558 4.0865 18.9135C4.14417 18.9712 4.21792 19 4.30775 19H7.2115V20.5H4.30775Z" fill="#D6D6D6"/>
                                        </svg>
                                    </button>
                                    <button id="thumbs-down-btn" class="feedback-btn" title="Not helpful">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3.30775 15.5C2.83208 15.5 2.41192 15.3176 2.04725 14.9528C1.68242 14.5881 1.5 14.1679 1.5 13.6923V12.077C1.5 11.972 1.5135 11.8595 1.5405 11.7395C1.56733 11.6197 1.59742 11.5077 1.63075 11.4037L4.49675 4.64125C4.63992 4.32142 4.88008 4.05125 5.21725 3.83075C5.55442 3.61025 5.90625 3.5 6.27275 3.5H16.7885V15.5L10.9713 21.2673C10.7724 21.4659 10.5423 21.5845 10.2808 21.623C10.0192 21.6615 9.76867 21.6167 9.529 21.4885C9.28917 21.3602 9.1135 21.1781 9.002 20.9423C8.8905 20.7064 8.86675 20.4622 8.93075 20.2095L10.0078 15.5H3.30775ZM15.2885 14.8615V5H6.26925C6.19875 5 6.12667 5.01925 6.053 5.05775C5.97917 5.09625 5.923 5.16033 5.8845 5.25L3 12V13.6923C3 13.7821 3.02883 13.8558 3.0865 13.9135C3.14417 13.9712 3.21792 14 3.30775 14H11.9038L10.65 19.4808L15.2885 14.8615ZM19.6923 3.5C20.1894 3.5 20.615 3.677 20.969 4.031C21.323 4.385 21.5 4.81058 21.5 5.30775V13.6923C21.5 14.1894 21.323 14.615 20.969 14.969C20.615 15.323 20.1894 15.5 19.6923 15.5H16.7885V14H19.6923C19.7821 14 19.8558 13.9712 19.9135 13.9135C19.9712 13.8558 20 13.7821 20 13.6923V5.30775C20 5.21792 19.9712 5.14417 19.9135 5.0865C19.8558 5.02883 19.7821 5 19.6923 5H16.7885V3.5H19.6923Z" fill="#D6D6D6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="ai-buttons">
                            <button id="refresh-btn" class="action-btn-circle hidden" type="button" title="Get alternate recommendations">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 4V1L8 5L12 9V6C15.31 6 18 8.69 18 12C18 13.01 17.75 13.97 17.3 14.8L18.76 16.26C19.54 15.03 20 13.57 20 12C20 7.58 16.42 4 12 4ZM12 18C8.69 18 6 15.31 6 12C6 10.99 6.25 10.03 6.7 9.2L5.24 7.74C4.46 8.97 4 10.43 4 12C4 16.42 7.58 20 12 20V23L16 19L12 15V18Z" fill="white"/>
                                </svg>
                            </button>
                            <button id="clear-btn" class="action-btn-circle" type="button" title="Clear answer">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="white"/>
                                </svg>
                            </button>
                            <button id="generate-btn" class="generate-btn-circle" type="button" title="Generate schedule">
                                <!-- Arrow Up SVG (default) -->
                                <svg id="arrow-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 4L12 20M12 4L8 8M12 4L16 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <!-- Checkmark SVG (shows when workouts received) -->
                                <svg id="check-icon" class="hidden" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="20" r="16" fill="#0055FF"/>
                                    <path d="M17.6346 23.577L13.7629 19.705C13.5321 19.4744 13.2419 19.3563 12.8925 19.3508C12.5433 19.3455 12.2479 19.4636 12.0062 19.705C11.7649 19.9466 11.6442 20.2394 11.6442 20.5833C11.6442 20.9272 11.7649 21.22 12.0062 21.4616L16.58 26.0354C16.8814 26.3365 17.2329 26.487 17.6346 26.487C18.0362 26.487 18.3878 26.3365 18.6892 26.0354L27.9617 16.7629C28.1922 16.532 28.3103 16.2419 28.3158 15.8925C28.3211 15.5433 28.203 15.2479 27.9617 15.0062C27.72 14.7648 27.4272 14.6441 27.0833 14.6441C26.7394 14.6441 26.4467 14.7648 26.205 15.0062L17.6346 23.577Z" fill="white"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Carousel - Dynamically loaded from JSON -->
                    <div id="carousel-container" class="carousel">
                        <!-- Cards will be generated dynamically -->
                    </div>
                </section>

                <!-- Refer Friends Section -->
                <section class="section">
                    <div class="section-header">
                        <h2>Refer your friends</h2>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="7" cy="12" r="1.5" fill="#676767"/>
                            <circle cx="12" cy="12" r="1.5" fill="#676767"/>
                            <circle cx="17" cy="12" r="1.5" fill="#676767"/>
                        </svg>
                    </div>

                    <div class="promo-cards">
                        <div class="promo-card">
                            <div class="promo-content">
                                <p>Get $40 when your friend joins ClassPass.</p>
                                <button class="btn-primary">Refer a friend</button>
                            </div>
                            <img src="https://media.canva.com/v2/image-resize/format:PNG/height:400/quality:100/uri:ifs%3A%2F%2FM%2F52cfec4d-89da-4d39-8f84-4fcd981675ff/watermark:F/width:254?csig=AAAAAAAAAAAAAAAAAAAAAJnz7FzoYKgS3m3z_L7NmQAjbAZg8u4CjfVufaD-d6Zb&exp=1762527292&osig=AAAAAAAAAAAAAAAAAAAAAIa166DgIAPL7VcBi5h_6C4F4MY3_2jl8rYsMBZ0Re69&signer=media-rpc&x-canva-quality=screen" alt="Refer">
                        </div>

                        <div class="promo-card">
                            <div class="promo-content">
                                <p>Share your profile with your friends to build your crew!</p>
                                <button class="btn-primary">Share Profile</button>
                            </div>
                            <div class="promo-icon">
                                <!-- Fist Bump Emoji -->
                                <span style="font-size: 64px;">ðŸ¤œðŸ¤›</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Note: Additional sections would continue here following the same pattern -->
                <!-- For brevity, I'll add a placeholder for the rest of the feed -->
                
                <div class="feed-placeholder">
                    <p class="text-center text-gray-500 py-8">Scroll for more recommendations, classes, and updates...</p>
                </div>

            </div>

        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-tabs">
                <button class="nav-tab active">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M9.88281 2.10754C11.0533 0.9421 12.9467 0.9421 14.1172 2.10754L21.8223 9.77942C22.5761 10.53 23 11.5505 23 12.6144V20.3605L22.9863 20.63C22.8601 21.8725 21.8724 22.8603 20.6299 22.9865L20.3604 23.0001H16.4717L16.2393 22.9884C15.1703 22.8798 14.3206 22.03 14.2119 20.9611L14.2002 20.7286V16.4386C14.2002 15.2994 13.3341 14.3616 12.2246 14.2491L12 14.2384C10.785 14.2384 9.7998 15.2236 9.7998 16.4386V20.4972L9.78711 20.7531C9.66728 21.931 8.73072 22.8677 7.55273 22.9874L7.29688 23.0001H3.40039L3.1543 22.9874C1.94427 22.8644 1.00004 21.8422 1 20.5997V12.6144C1.00002 11.6171 1.37245 10.6584 2.04004 9.92395L2.17773 9.77942L9.88281 2.10754ZM12.7061 3.52454C12.3159 3.13605 11.6841 3.13606 11.2939 3.52454L3.58887 11.1974C3.21202 11.5727 3.00002 12.0825 3 12.6144V20.5997C3.00004 20.8206 3.1795 21.0001 3.40039 21.0001H7.29688C7.57459 21 7.79951 20.7749 7.7998 20.4972V16.4386C7.7998 14.119 9.6804 12.2384 12 12.2384C14.3196 12.2384 16.2002 14.119 16.2002 16.4386V20.7286C16.2003 20.8786 16.3217 21.0001 16.4717 21.0001H20.3604C20.7135 20.9999 20.9998 20.7136 21 20.3605V12.6144C21 12.0825 20.788 11.5727 20.4111 11.1974L12.7061 3.52454Z" fill="black"/>
                    </svg>
                    <span>Home</span>
                </button>

                <button class="nav-tab">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M11 2C15.9706 2 20 6.02944 20 11C20 13.035 19.3234 14.9114 18.1846 16.4189L22.0479 19.8525C22.543 20.2928 22.5876 21.0526 22.1475 21.5479C21.7072 22.043 20.9474 22.0877 20.4521 21.6475L16.4922 18.127C14.9722 19.3 13.0685 20 11 20C6.02944 20 2 15.9706 2 11C2 6.02944 6.02944 2 11 2ZM11 4.2002C7.24446 4.2002 4.2002 7.24446 4.2002 11C4.2002 14.7555 7.24446 17.7998 11 17.7998C14.7555 17.7998 17.7998 14.7555 17.7998 11C17.7998 7.24446 14.7555 4.2002 11 4.2002Z" fill="#999999"/>
                    </svg>
                    <span>Search</span>
                </button>

                <button class="nav-tab">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12.069 8.25V15.75M15.8477 12H8.29023M21.1379 12C21.1379 7.03125 17.0758 3 12.069 3C7.06214 3 3 7.03125 3 12C3 16.9688 7.06214 21 12.069 21C17.0758 21 21.1379 16.9688 21.1379 12Z" stroke="#999999" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Add credits</span>
                </button>

                <button class="nav-tab">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M17 1C17.5523 1 18 1.44772 18 2V3H19C20.6569 3 22 4.34315 22 6V19C22 20.6051 20.7394 21.9158 19.1543 21.9961L19 22H5L4.8457 21.9961C3.26057 21.9158 2 20.6051 2 19V6C2 4.34316 3.34316 3.00002 5 3H6V2C6 1.44773 6.44773 1.00002 7 1C7.55228 1 8 1.44772 8 2V3H16V2C16 1.44772 16.4477 1 17 1ZM4 10V19C4 19.5523 4.44773 20 5 20H19C19.5523 20 20 19.5523 20 19V10H4ZM5 5C4.44773 5.00002 4 5.44773 4 6V8H20V6C20 5.44771 19.5523 5 19 5H18C18 5.55228 17.5523 6 17 6C16.4477 6 16 5.55228 16 5H8C8 5.55228 7.55228 6 7 6C6.44773 5.99998 6 5.55227 6 5H5Z" fill="#999999"/>
                    </svg>
                    <span>Upcoming</span>
                </button>

                <button class="nav-tab">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12.011 15C14.3736 15.0001 16.2966 15.4466 17.805 16.4229C19.3281 17.4088 20.3215 18.8652 20.9456 20.6738C21.1257 21.1958 20.8483 21.7651 20.3265 21.9453C19.8044 22.1254 19.2352 21.8482 19.055 21.3262C18.5404 19.835 17.7834 18.7906 16.7191 18.1016C15.6401 17.4032 14.1373 17.0001 12.011 17C9.88367 17 8.36065 17.4035 7.26886 18.1035C6.19436 18.7926 5.43714 19.8333 4.9505 21.3125C4.77795 21.837 4.21234 22.1226 3.68781 21.9502C3.1632 21.7776 2.87758 21.2121 3.05011 20.6875C3.65 18.864 4.65337 17.4051 6.18976 16.4199C7.70903 15.4458 9.64899 15 12.011 15ZM12.0003 1C15.7501 1.00017 18.0003 4.3223 18.0003 7.5C18.0003 10.8221 15.4502 13.9998 12.0003 14C8.55031 14 6.00031 10.8222 6.00031 7.5C6.00031 4.17778 8.40031 1 12.0003 1ZM12.0003 3C9.76139 3 8.00031 5.00707 8.00031 7.5C8.00031 9.95774 9.88056 12 12.0003 12C14.1199 11.9998 16.0003 9.95763 16.0003 7.5C16.0003 5.08585 14.3329 3.00017 12.0003 3Z" fill="#999999"/>
                    </svg>
                    <span>Profile</span>
                </button>
            </div>
            <div class="home-indicator"></div>
        </div>

    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99998;"></canvas>

    <script>
        console.log('ðŸŽ¬ JavaScript started loading...');
        
        // ============================================
        // CONFETTI ANIMATION
        // ============================================
        function triggerConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confetti = [];
            const confettiCount = 150;
            const colors = ['#0055FF', '#22A1E9', '#9F70E7', '#8362E4', '#FFD700', '#FF6B9D'];
            
            // Create confetti pieces
            for (let i = 0; i < confettiCount; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: -20,
                    size: Math.random() * 8 + 4,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 4 - 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }
            
            console.log('ðŸŽ‰ Confetti triggered!');
            
            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                confetti.forEach((piece, index) => {
                    ctx.save();
                    ctx.translate(piece.x, piece.y);
                    ctx.rotate((piece.rotation * Math.PI) / 180);
                    ctx.fillStyle = piece.color;
                    ctx.fillRect(-piece.size / 2, -piece.size / 2, piece.size, piece.size);
                    ctx.restore();
                    
                    // Update position
                    piece.y += piece.speedY;
                    piece.x += piece.speedX;
                    piece.rotation += piece.rotationSpeed;
                    
                    // Remove if off screen
                    if (piece.y > canvas.height) {
                        confetti.splice(index, 1);
                    }
                });
                
                if (confetti.length > 0) {
                    requestAnimationFrame(animateConfetti);
                } else {
                    // Clear canvas when done
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            
            animateConfetti();
        }
        
        // ============================================
        // INITIALIZE SESSION ID
        // ============================================
        if (!window.sessionId) {
            // Try to get from parent, or create new
            window.sessionId = (window.parent && window.parent.sessionId) || 'SID-' + Math.random().toString(36).substr(2, 12);
            console.log('ðŸ“‹ Initialized Session ID:', window.sessionId);
        }
        
        // ============================================
        // UPDATE REAL TIME IN STATUS BAR
        // ============================================
        function updateTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const timeString = `${hours}:${minutes.toString().padStart(2, '0')}`;
            
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }
        
        // Update time immediately and every minute
        updateTime();
        setInterval(updateTime, 60000); // Update every minute
        
        // ============================================
        // RANDOM THUMBNAIL POOL
        // ============================================
        const thumbnailPool = [
            "https://youfit.com/wp-content/uploads/2024/06/YouFit-06-20-22-2527-Edit.jpg",
            "https://images.peopleimages.com/picture/202301/2578135-fitness-yoga-or-woman-stretching-in-gym-for-balance-flexible-spine-or-warm-up-body-with-healthy-breathing.-floor-breathe-or-zen-girl-in-training-exercise-or-workout-with-focus-or-flexibility--fit_400_400.jpg",
            "https://t4.ftcdn.net/jpg/02/43/13/15/360_F_243131531_jmNppYX9Ux2Hj2RV9yYR1swicwcYr8EQ.jpg",
            "https://media.istockphoto.com/id/464423718/photo/friends-exercise-in-gym.jpg?s=612x612&w=0&k=20&c=irmY7ahTerWqqVDJBRdx7aqi0HttRY9gTBLHzOdpLek=",
            "https://www.guardian.in/cdn/shop/articles/What-is-the-importance-of-physical-fitness.jpg?crop=center&height=1200&v=1741004149&width=1200",
            "https://gravity.fitness/cdn/shop/files/11-GravityFitness.webp?v=1749120795&width=767",
            "https://media.istockphoto.com/id/1679800838/fr/photo/gros-plan-des-pieds-coureur-sportif-courant-sur-tapis-roulant-dans-un-club-de-fitness.jpg?s=612x612&w=0&k=20&c=79oBrSnh-TItQCgTq1w5Aey2POgA-sU8wJzWMhHJmUM=",
            "https://www.shutterstock.com/image-photo/squat-woman-exercise-down-strengthen-260nw-2660361719.jpg",
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvtWzabIH3STWW8YE5cOo1vluIYbAbTHgBkw&s",
            "https://media.istockphoto.com/id/610431768/photo/fitness-club-in-luxury-hotel-interior.jpg?s=612x612&w=0&k=20&c=IkusSsZFq1kauP2FhSSw0Jmx92WuSSvlksesEZGw0ik=",
            "https://c8.alamy.com/comp/B244P0/running-machines-in-a-generic-health-spa-gym-B244P0.jpg",
            "https://media.istockphoto.com/id/2075354173/photo/fitness-couple-is-doing-kettlebell-twist-in-a-gym-togehter.jpg?s=612x612&w=0&k=20&c=lfs1V1d0YB33tn72myi6FElJnylPJYYM9lW5ZhlnYqY=",
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZWrcdBxFUPxyatHy31ry4is4FRt7FdGZDjw&s",
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSsXy5Bewpi4bQSqaMuulMqGSX5PLF23FJ0g&s",
            "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Z3ltfGVufDB8fDB8fHww&fm=jpg&q=60&w=3000",
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwCB7lqPZdNX-jtbzjvAWHuanRQId5WZz0PrP2E95QBADAAtoYdEtVdY7N2hN82LDRyPM&usqp=CAU",
            "https://images.unsplash.com/photo-1526506118085-60ce8714f8c5?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8Z3ltfGVufDB8fDB8fHww&fm=jpg&q=60&w=3000",
            "https://img.freepik.com/photos-premium/moitie-femme-assise-table-orange_1048944-400826.jpg",
            "https://img.freepik.com/free-photo/group-people-exercising-together-outdoors_23-2151061445.jpg?semt=ais_hybrid&w=740&q=80"
        ];
        
        // Function to get random thumbnail
        function getRandomThumbnail() {
            return thumbnailPool[Math.floor(Math.random() * thumbnailPool.length)];
        }
        
        // ============================================
        // CAROUSEL DATA - JSON Structure
        // ============================================
        const carouselData = [
            {
                activity_title: "Sweat440",
                schedule_slot: "Mon, 9:00 AM",
                credits_amount: 12,
                studio: {
                    name: "Sweat440",
                    location: "Chelsea Â· 2.4 mi"
                },
                stars: 4.9,
                number_of_reviews: 5000,
                review_status: "Excellent",
                thumbnail: "https://media.canva.com/v2/image-resize/format:PNG/height:621/quality:100/uri:ifs%3A%2F%2FM%2Fccf97760-22d9-476f-ba59-be1ffc826ab6/watermark:F/width:1242?csig=AAAAAAAAAAAAAAAAAAAAAD6keSFzipm042Kn91yTIdHDl76ueT462PPeYJLuF7sw&exp=1762530008&osig=AAAAAAAAAAAAAAAAAAAAAM0wOMg5dXWgIw9S5lVrw-ipzGlqRCjqkAY72qRDQ-TZ&signer=media-rpc&x-canva-quality=screen_2x"
            },
            {
                activity_title: "The Fhitting Room",
                schedule_slot: "Mon, 6:00 PM",
                credits_amount: 14,
                studio: {
                    name: "The Fhitting Room",
                    location: "Flatiron Â· 2.9 mi"
                },
                stars: 4.9,
                number_of_reviews: 5000,
                review_status: "Excellent",
                thumbnail: "https://media.canva.com/v2/image-resize/format:PNG/height:621/quality:100/uri:ifs%3A%2F%2FM%2F23712ad4-4086-469f-84a0-bfcb5b7c6526/watermark:F/width:1242?csig=AAAAAAAAAAAAAAAAAAAAALVSsN_TIp7XVI0u9AIpC10XWemLoElxn1zPSl-he9WI&exp=1762527311&osig=AAAAAAAAAAAAAAAAAAAAAD8c50C0RKOy3Txwzc3OdbXNnKEt3WNTNFlxyIqeDSJ6&signer=media-rpc&x-canva-quality=screen_2x"
            },
            {
                activity_title: "Mile High Run Club",
                schedule_slot: "Tue, 7:00 AM",
                credits_amount: 11,
                studio: {
                    name: "Mile High Run Club",
                    location: "Noho Â· 3.2 mi"
                },
                stars: 4.9,
                number_of_reviews: 5000,
                review_status: "Excellent",
                thumbnail: "https://media.canva.com/v2/image-resize/format:PNG/height:320/quality:100/uri:ifs%3A%2F%2FM%2F2a15504f-4140-47a6-bd91-2d7f2c9bdc93/watermark:F/width:480?csig=AAAAAAAAAAAAAAAAAAAAAOzXL-K207sOKtRRolK70O8_xKb3uUbFXO88hr_-lOwi&exp=1762527610&osig=AAAAAAAAAAAAAAAAAAAAAIoFrTNX3k6wiqvd6wmDrOnDIBfnwivSOUpWoFmcSQdF&signer=media-rpc&x-canva-quality=screen"
            },
            {
                activity_title: "Barry's Bootcamp",
                schedule_slot: "Wed, 5:30 PM",
                credits_amount: 15,
                studio: {
                    name: "Barry's Bootcamp",
                    location: "Chelsea Â· 3.0 mi"
                },
                stars: 4.8,
                number_of_reviews: 7500,
                review_status: "Excellent",
                thumbnail: "https://i.ibb.co/ycC6fwND/85547e3101083a81c35e019c508e751a.png"
            },
            {
                activity_title: "SoulCycle",
                schedule_slot: "Thu, 6:30 AM",
                credits_amount: 13,
                studio: {
                    name: "SoulCycle",
                    location: "Tribeca Â· 3.5 mi"
                },
                stars: 4.7,
                number_of_reviews: 6200,
                review_status: "Excellent",
                thumbnail: "https://i.ibb.co/Rf62dHw/1bbf93da00625e1c67ed4eca71ec05ff.png"
            }
        ];

        // ============================================
         // CAROUSEL FUNCTIONALITY
         // ============================================
         document.addEventListener('DOMContentLoaded', function() {
             console.log('ðŸ“± DOM Content Loaded!');
             console.log('Looking for elements...');
             
             // Generate Skeleton Loading Cards
             function generateSkeletonCards(count = 3) {
                const container = document.getElementById('carousel-container');
                container.innerHTML = ''; // Clear existing content
                console.log('ðŸ¦´ Generating', count, 'skeleton cards');
                
                for (let i = 0; i < count; i++) {
                    const card = document.createElement('div');
                    card.className = 'skeleton-card';
                    
                    card.innerHTML = `
                        <div class="skeleton-image"></div>
                        <div class="carousel-content">
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line"></div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                }
                
                console.log('âœ… Skeleton cards displayed');
             }
             
             // Generate Carousel Cards from JSON
             function generateCarouselCards(data) {
                const container = document.getElementById('carousel-container');
                container.innerHTML = ''; // Clear existing content
                console.log('ðŸŽ¨ Generating', data.length, 'real cards');
                
                // Thumbnail pool for random selection
                const thumbnailPool = [
                    "https://youfit.com/wp-content/uploads/2024/06/YouFit-06-20-22-2527-Edit.jpg",
                    "https://images.peopleimages.com/picture/202301/2578135-fitness-yoga-or-woman-stretching-in-gym-for-balance-flexible-spine-or-warm-up-body-with-healthy-breathing.-floor-breathe-or-zen-girl-in-training-exercise-or-workout-with-focus-or-flexibility--fit_400_400.jpg",
                    "https://t4.ftcdn.net/jpg/02/43/13/15/360_F_243131531_jmNppYX9Ux2Hj2RV9yYR1swicwcYr8EQ.jpg",
                    "https://media.istockphoto.com/id/464423718/photo/friends-exercise-in-gym.jpg?s=612x612&w=0&k=20&c=irmY7ahTerWqqVDJBRdx7aqi0HttRY9gTBLHzOdpLek=",
                    "https://www.guardian.in/cdn/shop/articles/What-is-the-importance-of-physical-fitness.jpg?crop=center&height=1200&v=1741004149&width=1200",
                    "https://gravity.fitness/cdn/shop/files/11-GravityFitness.webp?v=1749120795&width=767",
                    "https://media.istockphoto.com/id/1679800838/fr/photo/gros-plan-des-pieds-coureur-sportif-courant-sur-tapis-roulant-dans-un-club-de-fitness.jpg?s=612x612&w=0&k=20&c=79oBrSnh-TItQCgTq1w5Aey2POgA-sU8wJzWMhHJmUM=",
                    "https://www.shutterstock.com/image-photo/squat-woman-exercise-down-strengthen-260nw-2660361719.jpg",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRvtWzabIH3STWW8YE5cOo1vluIYbAbTHgBkw&s",
                    "https://media.istockphoto.com/id/610431768/photo/fitness-club-in-luxury-hotel-interior.jpg?s=612x612&w=0&k=20&c=IkusSsZFq1kauP2FhSSw0Jmx92WuSSvlksesEZGw0ik=",
                    "https://c8.alamy.com/comp/B244P0/running-machines-in-a-generic-health-spa-gym-B244P0.jpg",
                    "https://media.istockphoto.com/id/2075354173/photo/fitness-couple-is-doing-kettlebell-twist-in-a-gym-togehter.jpg?s=612x612&w=0&k=20&c=lfs1V1d0YB33tn72myi6FElJnylPJYYM9lW5ZhlnYqY=",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZWrcdBxFUPxyatHy31ry4is4FRt7FdGZDjw&s",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSsXy5Bewpi4bQSqaMuulMqGSX5PLF23FJ0g&s",
                    "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Z3ltfGVufDB8fDB8fHww&fm=jpg&q=60&w=3000",
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwCB7lqPZdNX-jtbzjvAWHuanRQId5WZz0PrP2E95QBADAAtoYdEtVdY7N2hN82LDRyPM&usqp=CAU",
                    "https://images.unsplash.com/photo-1526506118085-60ce8714f8c5?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8Z3ltfGVufDB8fDB8fHww&fm=jpg&q=60&w=3000",
                    "https://img.freepik.com/photos-premium/moitie-femme-assise-table-orange_1048944-400826.jpg",
                    "https://img.freepik.com/free-photo/group-people-exercising-together-outdoors_23-2151061445.jpg?semt=ais_hybrid&w=740&q=80"
                ];
                
                data.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'carousel-card';
                    
                    // Format schedule slot for display (e.g., "Mon, 7:00 AM" â†’ "Mon Â· 7:00am")
                    let scheduleDisplay = item.schedule_slot || '';
                    let dayOfWeek = '';
                    
                    if (scheduleDisplay) {
                        // Extract day (first 3 letters before comma)
                        const dayMatch = scheduleDisplay.match(/^([A-Za-z]{3})/);
                        if (dayMatch) {
                            dayOfWeek = dayMatch[1];
                        }
                        
                        // Remove comma, convert to lowercase am/pm
                        scheduleDisplay = scheduleDisplay.replace(',', ' Â·').replace(' AM', 'am').replace(' PM', 'pm');
                    }
                    
                    // Use thumbnail from item if available (hardcoded data), otherwise use random (API responses)
                    const thumbnail = item.thumbnail || thumbnailPool[Math.floor(Math.random() * thumbnailPool.length)];
                    
                    card.innerHTML = `
                        <img src="${thumbnail}" alt="${item.activity_title}" class="carousel-img">
                        ${dayOfWeek ? `<div class="day-badge">${dayOfWeek}</div>` : ''}
                        <div class="carousel-content">
                            <h3>${item.activity_title}</h3>
                            <p class="location">${scheduleDisplay} Â· ${item.credits_amount} credits</p>
                            <p class="tags"><span style="text-decoration: underline;">${item.studio.name}</span> Â· ${item.studio.location}</p>
                            <div class="rating">
                                <span class="rating-score">${item.stars}</span>
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                                    <path d="M5.5616 1.25938C5.75146 0.913539 6.24833 0.913539 6.43819 1.25938L7.76271 3.67206C7.83452 3.80287 7.96101 3.89476 8.10761 3.92264L10.8115 4.43677C11.1991 4.51047 11.3526 4.98302 11.0824 5.27046L9.19708 7.2757C9.09487 7.38442 9.04655 7.53312 9.06534 7.68115L9.41192 10.4116C9.4616 10.803 9.05963 11.095 8.70274 10.9268L6.21306 9.75346C6.07807 9.68984 5.92173 9.68984 5.78674 9.75346L3.29705 10.9268C2.94017 11.095 2.53819 10.803 2.58787 10.4116L2.93445 7.68115C2.95324 7.53312 2.90493 7.38442 2.80271 7.2757L0.917423 5.27046C0.647177 4.98302 0.800717 4.51047 1.18831 4.43677L3.89219 3.92264C4.03879 3.89476 4.16528 3.80287 4.23709 3.67206L5.5616 1.25938Z" fill="black"/>
                                </svg>
                                <span class="rating-count">(${item.number_of_reviews >= 1000 ? (item.number_of_reviews / 1000).toFixed(0) + 'k' : item.number_of_reviews}+)</span>
                                <span class="rating-label">${item.review_status}</span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
                console.log('âœ… Real cards displayed');
             }
            
            // Initialize carousel with data
            generateCarouselCards(carouselData);
            
            // Add drag to scroll functionality
            const carousel = document.getElementById('carousel-container');
            let isDown = false;
            let startX;
            let scrollLeft;
            
            carousel.addEventListener('mousedown', (e) => {
                isDown = true;
                carousel.style.cursor = 'grabbing';
                startX = e.pageX - carousel.offsetLeft;
                scrollLeft = carousel.scrollLeft;
            });
            
            carousel.addEventListener('mouseleave', () => {
                isDown = false;
                carousel.style.cursor = 'grab';
            });
            
            carousel.addEventListener('mouseup', () => {
                isDown = false;
                carousel.style.cursor = 'grab';
            });
            
            carousel.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - carousel.offsetLeft;
                const walk = (x - startX) * 2; // Scroll speed multiplier
                carousel.scrollLeft = scrollLeft - walk;
            });
            
            // Touch support for mobile
            let touchStartX = 0;
            let touchScrollLeft = 0;
            
            carousel.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].pageX;
                touchScrollLeft = carousel.scrollLeft;
            }, { passive: true });
            
            carousel.addEventListener('touchmove', (e) => {
                const x = e.touches[0].pageX;
                const walk = (touchStartX - x) * 1.5;
                carousel.scrollLeft = touchScrollLeft + walk;
            }, { passive: true });
            
            // ============================================
             // AI ICON FUNCTIONALITY
             // ============================================
             const aiIcon = document.getElementById('ai-icon');
             const sectionTitle = document.getElementById('section-title');
             const aiInputBox = document.getElementById('ai-input-box');
             const generateBtn = document.getElementById('generate-btn');
             
             let isAIMode = false;
             let isGenerating = false;
             let hasResponse = false; // Track if textarea has API response
             let hasWorkouts = false; // Track if we have workout schedule
             let isCheckmarkMode = false; // Track if button shows checkmark
             let abortController = null; // For canceling API requests
             let chatHistory = []; // Store conversation history
             let currentUserInput = ''; // Track current user typing
             
             const bookAllBtn = document.getElementById('book-all-btn');
             const refreshBtn = document.getElementById('refresh-btn');
             const clearBtn = document.getElementById('clear-btn');
             const arrowIcon = document.getElementById('arrow-icon');
             const checkIcon = document.getElementById('check-icon');
             const chatMessagesContainer = document.getElementById('chat-messages');
             const feedbackButtons = document.getElementById('feedback-buttons');
             const thumbsUpBtn = document.getElementById('thumbs-up-btn');
             const thumbsDownBtn = document.getElementById('thumbs-down-btn');
             
             // ============================================
             // CHAT HISTORY FUNCTIONS
             // ============================================
             
             // Add message to chat history and render
             function addChatMessage(text, isBot = false, isThinking = false) {
                 const message = {
                     text: text,
                     isBot: isBot,
                     isThinking: isThinking,
                     id: Date.now()
                 };
                 
                 chatHistory.push(message);
                 renderChatHistory();
                 
                 // Auto-scroll to bottom of container
                 setTimeout(() => {
                     const container = document.getElementById('chat-container');
                     if (container) {
                         container.scrollTop = container.scrollHeight;
                     }
                 }, 100);
                 
                 return message.id;
             }
             
             // Update a specific message (for replacing "Thinking...")
             function updateChatMessage(messageId, newText) {
                 const message = chatHistory.find(m => m.id === messageId);
                 if (message) {
                     message.text = newText;
                     message.isThinking = false;
                     renderChatHistory();
                 }
             }
             
             // Render all chat messages
             function renderChatHistory() {
                 if (!chatMessagesContainer) return;
                 
                 chatMessagesContainer.innerHTML = '';
                 
                 chatHistory.forEach(message => {
                     // Skip thinking messages (they should be replaced or removed)
                     if (message.isThinking) {
                         return;
                     }
                     
                     const msgDiv = document.createElement('div');
                     msgDiv.className = message.isBot ? 'bot-message' : 'user-message';
                     msgDiv.textContent = message.text;
                     chatMessagesContainer.appendChild(msgDiv);
                 });
             }
             
             // Function to disable all buttons (except X which is always enabled)
             function disableAllButtons() {
                 if (generateBtn) generateBtn.classList.add('disabled');
                 if (refreshBtn) refreshBtn.classList.add('disabled');
                 // Keep clearBtn always enabled
                 console.log('ðŸ”’ Buttons disabled (except X)');
             }
             
             // Function to enable buttons
             function enableButtons() {
                 if (refreshBtn) refreshBtn.classList.remove('disabled');
                 // clearBtn is always enabled, no need to change it
                 // Generate button state is controlled by updateGenerateButtonState()
                 updateGenerateButtonState();
                 console.log('ðŸ”“ Buttons enabled');
             }
             
             // Function to switch button to checkmark
             function switchToCheckmark() {
                 if (arrowIcon && checkIcon) {
                     arrowIcon.classList.add('hidden');
                     checkIcon.classList.remove('hidden');
                     isCheckmarkMode = true;
                     if (generateBtn) {
                         generateBtn.setAttribute('title', 'Collapse schedule');
                         generateBtn.classList.remove('disabled');
                     }
                     console.log('âœ… Switched to checkmark mode');
                 }
             }
             
             // Function to switch button back to arrow
             function switchToArrow() {
                 if (arrowIcon && checkIcon) {
                     checkIcon.classList.add('hidden');
                     arrowIcon.classList.remove('hidden');
                     isCheckmarkMode = false;
                     if (generateBtn) {
                         generateBtn.setAttribute('title', 'Generate schedule');
                     }
                     console.log('â¬†ï¸ Switched to arrow mode');
                 }
             }
             
             // Function to update generate button state
             function updateGenerateButtonState() {
                 const textarea = document.getElementById('ai-textarea');
                 
                 if (!generateBtn || !textarea) return;
                 
                 // If in checkmark mode, always keep enabled
                 if (isCheckmarkMode) {
                     generateBtn.classList.remove('disabled');
                     console.log('âœ… Generate button enabled (checkmark mode)');
                     return;
                 }
                 
                 const isEmpty = !textarea.value.trim();
                 // Don't check hasResponse for disabling - we want to allow continuous chat
                 const shouldDisable = isEmpty || isGenerating;
                 
                 if (shouldDisable) {
                     generateBtn.classList.add('disabled');
                     console.log('ðŸš« Generate button disabled:', { isEmpty, isGenerating });
                 } else {
                     generateBtn.classList.remove('disabled');
                     console.log('âœ… Generate button enabled');
                 }
             }
             
             aiIcon.addEventListener('click', function(e) {
                 e.preventDefault();
                 isAIMode = !isAIMode;
                 
                 // Add visual feedback to icon click
                 aiIcon.style.transform = 'scale(0.9)';
                 setTimeout(() => {
                     aiIcon.style.transform = '';
                 }, 150);
                 
                 if (isAIMode) {
                     // Switch to AI mode with smooth transition
                     sectionTitle.style.opacity = '0';
                     sectionTitle.style.transform = 'translateY(-5px)';
                     
                     setTimeout(() => {
                         sectionTitle.textContent = 'Generate schedule';
                         sectionTitle.classList.add('ai-active');
                         sectionTitle.classList.remove('ai-generating');
                         sectionTitle.style.opacity = '1';
                         sectionTitle.style.transform = 'translateY(0)';
                         
                         // Show input box after title animation
                         setTimeout(() => {
                             aiInputBox.classList.remove('hidden');
                             // Auto-focus the textarea and ensure placeholder
                             const textarea = document.getElementById('ai-textarea');
                             if (textarea) {
                                 textarea.placeholder = 'Plan your week with AI';
                                 setTimeout(() => textarea.focus(), 100);
                             }
                             // Initial button state (disabled when empty)
                             updateGenerateButtonState();
                         }, 200);
                     }, 250);
                     
                 } else {
                     // Reset generating state
                     isGenerating = false;
                     hasResponse = false;
                     hasWorkouts = false;
                     
                     // Hide "Book all" button, refresh button, and feedback buttons
                     if (bookAllBtn) {
                         bookAllBtn.classList.add('hidden');
                     }
                     if (refreshBtn) {
                         refreshBtn.classList.add('hidden');
                     }
                     if (feedbackButtons) {
                         feedbackButtons.classList.add('hidden');
                         // Reset feedback selection
                         if (thumbsUpBtn) thumbsUpBtn.classList.remove('selected');
                         if (thumbsDownBtn) thumbsDownBtn.classList.remove('selected');
                     }
                     
                     // Switch checkmark back to arrow
                     switchToArrow();
                     
                     // Hide input box with fade out
                     aiInputBox.style.opacity = '0';
                     aiInputBox.style.transform = 'translateY(-10px)';
                     
                     setTimeout(() => {
                         aiInputBox.classList.add('hidden');
                         aiInputBox.style.opacity = '';
                         aiInputBox.style.transform = '';
                         
                         // Reset textarea
                         const textarea = document.getElementById('ai-textarea');
                         if (textarea) {
                             textarea.value = '';
                         }
                     }, 300);
                     
                     // Reset carousel to original
                     generateCarouselCards(carouselData);
                     
                     setTimeout(() => {
                         sectionTitle.style.opacity = '0';
                         sectionTitle.style.transform = 'translateY(-5px)';
                         
                         setTimeout(() => {
                             sectionTitle.textContent = 'Recommended for you';
                             sectionTitle.classList.remove('ai-active');
                             sectionTitle.classList.remove('ai-generating');
                             sectionTitle.classList.remove('ai-completed');
                             sectionTitle.style.opacity = '1';
                             sectionTitle.style.transform = 'translateY(0)';
                         }, 250);
                     }, 150);
                 }
             });
             
             // ============================================
             // GENERATE BUTTON CLICK HANDLER
             // ============================================
             if (generateBtn) {
                 console.log('âœ… Generate button found, attaching listener');
                 
                 generateBtn.addEventListener('click', async function(e) {
                     e.preventDefault();
                     e.stopPropagation();
                     console.log('ðŸš€ Button CLICKED! Checkmark mode:', isCheckmarkMode);
                     
                     // Check if button is disabled
                     if (generateBtn.classList.contains('disabled')) {
                         console.log('ðŸš« Button is disabled, ignoring click');
                         return;
                     }
                     
                     // If in checkmark mode, collapse textbox and show "Book all"
                     if (isCheckmarkMode) {
                         console.log('âœ… Checkmark clicked - Collapsing textbox');
                         
                         // Collapse textbox with animation
                         aiInputBox.style.opacity = '0';
                         aiInputBox.style.transform = 'translateY(-10px)';
                         
                         setTimeout(() => {
                             aiInputBox.classList.add('hidden');
                             aiInputBox.style.opacity = '';
                             aiInputBox.style.transform = '';
                         }, 300);
                         
                         // Title stays as "This week's plan" (black)
                         sectionTitle.textContent = "This week's plan";
                         sectionTitle.classList.remove('ai-active');
                         sectionTitle.classList.remove('ai-generating');
                         sectionTitle.classList.add('ai-completed');
                         
                         // NOW show "Book all" button
                         if (bookAllBtn) {
                             bookAllBtn.classList.remove('hidden');
                             console.log('ðŸ“˜ "Book all" button shown after confirmation');
                         }
                         
                         // Keep carousel with workout data
                         
                         console.log('âœ… Textbox collapsed, schedule visible');
                         return;
                     }
                     
                     // Otherwise, standard arrow button behavior (make API request)
                     if (!isGenerating && !hasResponse) {
                         isGenerating = true;
                         console.log('Starting generation process...');
                         
                         const textarea = document.getElementById('ai-textarea');
                         const userInput = textarea ? textarea.value.trim() : '';
                         
                         if (!userInput) {
                             console.log('âš ï¸ No user input');
                             isGenerating = false;
                             return;
                         }
                         
                         const sessionId = window.parent.sessionId || window.sessionId || 'SID-default';
                         
                         console.log('User Input:', userInput);
                         console.log('Session ID:', sessionId);
                         
                         // Add user message to chat history
                         addChatMessage(userInput, false);
                         
                         // Clear textarea and disable it during request
                         textarea.value = '';
                         textarea.style.height = 'auto';
                         textarea.disabled = true;
                         
                         // Remove placeholder after first message
                         if (chatHistory.length > 0) {
                             textarea.placeholder = '';
                         }
                         
                         // Add "Thinking..." message (will be replaced with answer)
                         const thinkingId = addChatMessage('Thinking...', true, true);
                         
                         // Disable all buttons during request
                         disableAllButtons();
                         
                         // Start generating animation
                         generateBtn.classList.add('generating');
                         
                         // Change title to "Generating schedule..." with gradient
                         sectionTitle.style.opacity = '0';
                         
                         setTimeout(() => {
                             sectionTitle.textContent = 'Generating schedule';
                             sectionTitle.classList.remove('ai-active');
                             sectionTitle.classList.add('ai-generating');
                             sectionTitle.style.opacity = '1';
                             console.log('âœ¨ Title updated to generating state');
                             
                             // Show skeleton cards while loading
                             generateSkeletonCards(3);
                             
                             // Make API call with thinking message ID
                             makeAPICall(userInput, sessionId, thinkingId);
                             
                         }, 200);
                     }
                 });
             } else {
                 console.error('âŒ Generate button NOT found!');
             }
             
             // ============================================
             // FEEDBACK BUTTONS - Thumbs Up/Down
             // ============================================
             if (thumbsUpBtn) {
                 thumbsUpBtn.addEventListener('click', function(e) {
                     e.preventDefault();
                     console.log('ðŸ‘ Thumbs up clicked');
                     
                     // Toggle selected state
                     thumbsUpBtn.classList.toggle('selected');
                     thumbsDownBtn.classList.remove('selected');
                     
                     // Optional: Send feedback to API
                     console.log('Positive feedback recorded');
                 });
             }
             
             if (thumbsDownBtn) {
                 thumbsDownBtn.addEventListener('click', function(e) {
                     e.preventDefault();
                     console.log('ðŸ‘Ž Thumbs down clicked');
                     
                     // Toggle selected state
                     thumbsDownBtn.classList.toggle('selected');
                     thumbsUpBtn.classList.remove('selected');
                     
                     // Optional: Send feedback to API
                     console.log('Negative feedback recorded');
                 });
             }
             
             // ============================================
             // BOOK ALL BUTTON - Trigger Confetti
             // ============================================
             if (bookAllBtn) {
                 bookAllBtn.addEventListener('click', function(e) {
                     e.preventDefault();
                     console.log('ðŸŽ‰ Book all clicked! Triggering confetti...');
                     
                     // Trigger confetti animation
                     triggerConfetti();
                     
                     // Optional: Add visual feedback to button
                     bookAllBtn.style.transform = 'scale(0.95)';
                     setTimeout(() => {
                         bookAllBtn.style.transform = '';
                     }, 150);
                 });
             }
             
             // ============================================
             // REFRESH BUTTON - Get Alternate Recommendations
             // ============================================
             if (refreshBtn) {
                 refreshBtn.addEventListener('click', async function(e) {
                     e.preventDefault();
                     console.log('ðŸ”„ Refresh button clicked - Getting alternate recommendations!');
                     
                     if (isGenerating) {
                         console.log('âš ï¸ Already generating, ignoring click');
                         return;
                     }
                     
                     // Start generating state
                     isGenerating = true;
                     disableAllButtons();
                     
                     const sessionId = window.parent.sessionId || window.sessionId || 'SID-default';
                     
                     // Add "Getting alternate recommendations..." to chat
                     const thinkingId = addChatMessage('Getting alternate recommendations...', true, true);
                     
                     // Clear textarea
                     const textarea = document.getElementById('ai-textarea');
                     if (textarea) {
                         textarea.value = '';
                         textarea.style.height = 'auto';
                     }
                     
                     // Change title to generating state
                     sectionTitle.style.opacity = '0';
                     setTimeout(() => {
                         sectionTitle.textContent = 'Generating schedule';
                         sectionTitle.classList.add('ai-generating');
                         sectionTitle.style.opacity = '1';
                     }, 200);
                     
                     // Show skeleton cards
                     generateSkeletonCards(3);
                     
                     // Make API call with "Give me alternate recommendations"
                     makeAPICall('Give me alternate recommendations', sessionId, thinkingId);
                     
                     console.log('ðŸ“¡ Requesting alternate recommendations with same session');
                 });
             }
             
             // ============================================
             // CLEAR BUTTON - Clear Answer, Keep Session
             // ============================================
             if (clearBtn) {
                 clearBtn.addEventListener('click', function(e) {
                     e.preventDefault();
                     console.log('âœ–ï¸ Clear button clicked - Collapsing AI section');
                     
                     // If request is ongoing, cancel it
                     if (isGenerating && abortController) {
                         console.log('ðŸ›‘ Canceling ongoing request...');
                         abortController.abort();
                         abortController = null;
                     }
                     
                     // Collapse AI input box
                     aiInputBox.style.opacity = '0';
                     aiInputBox.style.transform = 'translateY(-10px)';
                     
                     setTimeout(() => {
                         aiInputBox.classList.add('hidden');
                         aiInputBox.style.opacity = '';
                         aiInputBox.style.transform = '';
                         
                         // Clear textarea and chat history
                         const textarea = document.getElementById('ai-textarea');
                         if (textarea) {
                             textarea.value = '';
                             textarea.style.color = '#000000';
                             textarea.disabled = false;
                             textarea.readOnly = false;
                             textarea.style.height = 'auto';
                         }
                         
                         // Clear chat history and restore placeholder
                         chatHistory = [];
                         renderChatHistory();
                         textarea.placeholder = 'Plan your week with AI';
                     }, 300);
                     
                     // Reset title to "Recommended for you"
                     setTimeout(() => {
                         sectionTitle.style.opacity = '0';
                         setTimeout(() => {
                             sectionTitle.textContent = 'Recommended for you';
                             sectionTitle.classList.remove('ai-active');
                             sectionTitle.classList.remove('ai-generating');
                             sectionTitle.classList.remove('ai-completed');
                             sectionTitle.style.opacity = '1';
                         }, 200);
                     }, 150);
                     
                     // Reset states
                     isAIMode = false;
                     isGenerating = false;
                     hasResponse = false;
                     hasWorkouts = false;
                     
                     // Hide "Book all" button, refresh button, and feedback buttons
                     if (bookAllBtn) {
                         bookAllBtn.classList.add('hidden');
                     }
                     if (refreshBtn) {
                         refreshBtn.classList.add('hidden');
                     }
                     if (feedbackButtons) {
                         feedbackButtons.classList.add('hidden');
                         // Reset feedback selection
                         if (thumbsUpBtn) thumbsUpBtn.classList.remove('selected');
                         if (thumbsDownBtn) thumbsDownBtn.classList.remove('selected');
                     }
                     
                     // Switch checkmark back to arrow
                     switchToArrow();
                     
                     if (generateBtn) {
                         generateBtn.classList.remove('generating');
                     }
                     
                     // Re-enable other buttons
                     enableButtons();
                     
                     // Show original carousel
                     generateCarouselCards(carouselData);
                     
                     console.log('âœ… AI section collapsed, back to "Recommended for you"');
                     console.log('Current Session ID (unchanged):', window.sessionId);
                 });
             }
             
             // ============================================
             // API CALL FUNCTION
             // ============================================
             async function makeAPICall(chatInput, sessionId, thinkingMessageId) {
                 console.log('ðŸ“¡ Making API call...');
                 
                 try {
                     // Create AbortController for this request
                     abortController = new AbortController();
                     
                     const payload = {
                         action: 'sendMessage',
                         chatInput: chatInput || 'Generate a workout schedule',
                         sessionId: sessionId
                     };
                     
                     console.log('Request payload:', JSON.stringify(payload, null, 2));
                     
                     const response = await fetch('https://chatcoachhackathon.app.n8n.cloud/webhook/a889d2ae-2159-402f-b326-5f61e90f602e/chat', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                         },
                         body: JSON.stringify(payload),
                         signal: abortController.signal
                     });
                     
                     console.log('Response status:', response.status);
                     
                     if (!response.ok) {
                         throw new Error(`HTTP error! status: ${response.status}`);
                     }
                     
                     const rawData = await response.json();
                     console.log('âœ… Raw API Response:', rawData);
                     console.log('Raw data type:', typeof rawData);
                     console.log('Raw data keys:', Object.keys(rawData));
                     
                     // Parse the output field which contains the actual JSON
                     let data;
                     if (rawData.output) {
                         console.log('ðŸ“¦ Parsing output field...');
                         console.log('Output content:', rawData.output);
                         console.log('Output type:', typeof rawData.output);
                         
                         try {
                             data = JSON.parse(rawData.output);
                             console.log('âœ… Parsed data successfully:', data);
                         } catch (parseError) {
                             console.error('âŒ Error parsing output:', parseError);
                             console.log('Output that failed to parse:', rawData.output);
                             data = rawData;
                         }
                     } else {
                         console.log('No output field, using rawData directly');
                         data = rawData;
                     }
                     
                     console.log('ðŸ“‹ Final data object:', data);
                     console.log('ðŸ“‹ Has answer?', 'answer' in data);
                     console.log('ðŸ“‹ Has workout_schedule?', 'workout_schedule' in data);
                     
                    console.log('Answer from API:', data.answer);
                    console.log('Workout schedule:', data.workout_schedule);
                    
                    // Always remove/replace "Thinking..." message when response arrives
                    const thinkingIndex = chatHistory.findIndex(m => m.id === thinkingMessageId);
                    if (thinkingIndex !== -1) {
                        const hasAnswer = data.answer && typeof data.answer === 'string' && data.answer.trim().length > 0;
                        
                        if (hasAnswer) {
                            // Replace "Thinking..." with actual answer
                            console.log('ðŸ“ Updating "Thinking..." with answer');
                            updateChatMessage(thinkingMessageId, data.answer.trim());
                            console.log('âœ… Answer added to chat history');
                        } else {
                            // Remove thinking message if no answer text (workouts will be shown in carousel)
                            console.log('ðŸ“ Removing "Thinking..." message (no answer text, workouts will be shown)');
                            chatHistory.splice(thinkingIndex, 1);
                            renderChatHistory();
                        }
                    } else {
                        console.warn('âš ï¸ Could not find thinking message with ID:', thinkingMessageId);
                    }
                    
                    // Update carousel with workout schedule
                    if (data.workout_schedule && data.workout_schedule.length > 0) {
                         console.log('ðŸ‹ï¸ Updating carousel with', data.workout_schedule.length, 'workouts');
                         
                         const newCarouselData = data.workout_schedule.map(item => ({
                             activity_title: item.classTitle,
                             schedule_slot: item.slotLabel,
                             credits_amount: item.credits,
                             studio: {
                                 name: item.studio.name,
                                 location: `${item.studio.neighborhood} Â· ${item.studio.distance} ${item.studio.distanceUnit}`
                             },
                             stars: item.rating.average,
                             number_of_reviews: item.rating.count,
                             review_status: item.rating.badge
                             // No thumbnail - will use random from pool
                         }));
                         
                         generateCarouselCards(newCarouselData);
                         console.log('âœ… Carousel updated with new workouts!');
                         
                         // Mark that we have workouts (but don't show "Book all" yet)
                         hasWorkouts = true;
                         
                         // Show refresh button (alternate recommendations)
                         if (refreshBtn) {
                             refreshBtn.classList.remove('hidden');
                             refreshBtn.classList.remove('disabled');
                             console.log('ðŸ”„ Refresh button shown (alternate recommendations)');
                         }
                         
                         // Show feedback buttons
                         if (feedbackButtons) {
                             feedbackButtons.classList.remove('hidden');
                             console.log('ðŸ‘ Feedback buttons shown');
                         }
                         
                         sectionTitle.textContent = "This week's plan";
                         sectionTitle.classList.remove('ai-active');
                         sectionTitle.classList.remove('ai-generating');
                         sectionTitle.classList.add('ai-completed');
                         
                         // Switch arrow button to checkmark
                         switchToCheckmark();
                         
                         // Note: "Book all" button will appear when checkmark is clicked
                         
                     } else {
                         console.log('âš ï¸ Empty workout_schedule, showing original carousel');
                         generateCarouselCards(carouselData);
                         hasWorkouts = false;
                         
                         // Hide both "Book all" and refresh buttons
                         if (bookAllBtn) {
                             bookAllBtn.classList.add('hidden');
                         }
                         if (refreshBtn) {
                             refreshBtn.classList.add('hidden');
                         }
                         
                         console.log('âœ… Original carousel restored!');
                     }
                     
                     // Stop generating animation and re-enable buttons
                     generateBtn.classList.remove('generating');
                     isGenerating = false;
                     hasResponse = false; // Allow user to type more
                     enableButtons();
                     
                     // Re-enable textarea for new input
                     const textarea = document.getElementById('ai-textarea');
                     console.log('ðŸ“ Re-enabling textarea:', textarea);
                     console.log('ðŸ“ Textarea disabled before:', textarea ? textarea.disabled : 'null');
                     
                     if (textarea) {
                         textarea.disabled = false;
                         textarea.readOnly = false;
                         // Keep placeholder empty after first message
                         if (chatHistory.length === 0) {
                             textarea.placeholder = 'Plan your week with AI';
                         }
                         textarea.style.color = '#000000';
                         console.log('ðŸ“ Textarea disabled after:', textarea.disabled);
                         console.log('âœ… Textarea re-enabled and ready');
                         setTimeout(() => textarea.focus(), 200);
                     } else {
                         console.error('âŒ Could not find textarea to re-enable!');
                     }
                     
                     // Change title back (or keep "This week's plan" if has workouts)
                     setTimeout(() => {
                         sectionTitle.style.opacity = '0';
                         setTimeout(() => {
                             if (hasWorkouts) {
                                 // Keep "This week's plan" in black
                                 sectionTitle.textContent = "This week's plan";
                                 sectionTitle.classList.remove('ai-generating');
                                 sectionTitle.classList.add('ai-completed');
                             } else {
                                 sectionTitle.textContent = 'Generate schedule';
                                 sectionTitle.classList.remove('ai-generating');
                                 sectionTitle.classList.add('ai-active');
                             }
                             sectionTitle.style.opacity = '1';
                         }, 200);
                     }, 500);
                     
                 } catch (error) {
                     // Check if request was aborted
                     if (error.name === 'AbortError') {
                         console.log('ðŸ›‘ Request canceled by user');
                         return; // Don't show error for canceled requests
                     }
                     
                     console.error('âŒ API Error:', error);
                     
                     // Update thinking message with error
                     updateChatMessage(thinkingMessageId, 'Error: Failed to generate schedule. Please try again.');
                     
                     // Reset state and re-enable buttons
                     generateBtn.classList.remove('generating');
                     isGenerating = false;
                     hasResponse = false; // Allow user to try again
                     enableButtons();
                     
                     // Re-enable textarea
                     const textarea = document.getElementById('ai-textarea');
                     if (textarea) {
                         textarea.disabled = false;
                         // Keep placeholder empty after first message
                         if (chatHistory.length === 0) {
                             textarea.placeholder = 'Plan your week with AI';
                         }
                         setTimeout(() => textarea.focus(), 100);
                     }
                     
                     // Show original carousel
                     generateCarouselCards(carouselData);
                     
                     setTimeout(() => {
                         sectionTitle.style.opacity = '0';
                         setTimeout(() => {
                             sectionTitle.textContent = 'Generate schedule';
                             sectionTitle.classList.remove('ai-generating');
                             sectionTitle.classList.add('ai-active');
                             sectionTitle.style.opacity = '1';
                         }, 200);
                     }, 500);
                 } finally {
                     abortController = null;
                 }
             }
             
             // Handle Enter key in textarea
             const aiTextarea = document.getElementById('ai-textarea');
             
             if (aiTextarea) {
                 // Allow selection in textarea
                 aiTextarea.addEventListener('mousedown', function(e) {
                     e.stopPropagation();
                 });
                 
                 aiTextarea.addEventListener('selectstart', function(e) {
                     e.stopPropagation();
                 });
                 
                 // Auto-resize textarea and update button state as user types
                 aiTextarea.addEventListener('input', function() {
                     this.style.height = 'auto';
                     this.style.height = this.scrollHeight + 'px';
                     
                     // Update button state on every keystroke
                     updateGenerateButtonState();
                 });
                 
                 // Enter without shift triggers generate (only if enabled)
                 aiTextarea.addEventListener('keydown', function(e) {
                     if (e.key === 'Enter' && !e.shiftKey && !isGenerating && !hasResponse) {
                         e.preventDefault();
                         if (generateBtn && !generateBtn.classList.contains('disabled')) {
                             generateBtn.click();
                         }
                     }
                 });
             }
            
            // Example function to update carousel dynamically
            window.updateCarousel = function(newData) {
                generateCarouselCards(newData);
            };
        });
    </script>

</body>
</html>

